<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Importeer roosters</title>
  </head>
  <body>
      <input type="file" id="files" name="file" /> Read bytes:
      <span class="readBytesButtons">
        <button>entire file</button>
      </span>
      <div id="byte_range"></div>
      <div id="byte_content"></div>
      
      <script>
        function readBlob(opt_startByte, opt_stopByte) {
          var files = document.getElementById("files").files;
          if (!files.length) {
            alert("Please select a file!");
            return;
          }
      
          var file = files[0];
          var start = parseInt(opt_startByte) || 0;
          var stop = parseInt(opt_stopByte) || file.size - 1;
      
          var reader = new FileReader();
          var xhttp = new XMLHttpRequest();
      
          // If we use onloadend, we need to check the readyState.
          reader.onloadend = function(evt) {
            if (evt.target.readyState == FileReader.DONE) {
              // DONE == 2
              xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  document.getElementById(
                    "byte_content"
                  ).innerHTML = this.responseText;
                  console.log(this.responseText);
                }
              };
              xhttp.open(
                "POST",
                "https://roosters.netlify.com/.netlify/functions/airtable",
                true
              );
              xhttp.setRequestHeader("Content-type", "application/json");
              xhttp.send(
                JSON.stringify({
                  data: evt.target.result
                })
              );
            }
          };
      
          var blob = file.slice(start, stop + 1);
          reader.readAsBinaryString(blob);
        }
      
        document.querySelector(".readBytesButtons").addEventListener(
          "click",
          function(evt) {
            if (evt.target.tagName.toLowerCase() == "button") {
              readBlob();
            }
          },
          false
        );
      </script>      
  </body>
</html>
